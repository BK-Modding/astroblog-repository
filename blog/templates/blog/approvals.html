{% extends 'layout.html' %}

{% block content %}
    <div class="container">
        {% if approved_post %}
            <div class="row">
                <div class="col s12">
                    <div class="card green white-text">
                        <div class="card-content flow-text">
                            You have approved the post '{{ approved_post.title }}' by author {{ approved_post.author.username }}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        {% if denied_post %}
            <div class="row">
                <div class="col s12">
                    <div class="card red white-text">
                        <div class="card-content flow-text">
                            You have denied the post '{{ denied_post.title }}' by author {{ denied_post.author.username }}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        {% if denied_error %}
             <div class="row">
                <div class="col s12">
                    <div class="card red white-text">
                        <div class="card-content flow-text">
                            Couldn't deny the post '{{ denied_post.title }}' by {{ denied_post.author.username }} because no moderation comments were provided
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="row">
            <div class="col s12">
                <h1>Pending approvals</h1>
            </div>
        </div>
        <hr>
        {% for post in posts %}
            <div class="row">
                <div class="col s12">
                    <h4>{{ post.title }}</h4>
                </div>
            </div>
            <div class="row">
                <div class="col s4">
                    <h6>{{ post.dateandtime }}</h6>
                </div>
                <div class="col s8 right-align">
                    <h6>Written by {{ post.author.username }}</h6>
                </div>
            </div>
            <div class="row">
                <div class="col s8">
                    {{ post.summary | safe }}<a href="{% url 'blogpost' post.id %}">....(read more)</a>
                </div>
                <div class="col s4 right-align">
                    <img src="{{ post.image.url }}" class="responsive-img" />
                </div>
            </div>
            <div class="row">
                <div class="col s4">
                    <form id="approvalform" method='post' action="{% url 'approve' post.id %}">
                        {% csrf_token %}
                        <input type="hidden"/>
                    </form>
                    <a href="javascript:{document.getElementById('approvalform').submit();}" class = "btn btn-large green waves-effect">Approve</a>
                </div>
                <div class="col s4 right-align">
                    <a class="waves-effect waves-light btn modal-trigger red btn-large" href="#denymodal">Deny</a>
                      <div id="denymodal" class="modal">
                        <div class="modal-content">
                            <form id="denialform" method='post' action="{% url 'deny' post.id %}">
                                {% csrf_token %}
                                <p class = "flow-text left-align">Comments/reasons for denial: </p>
                                <div class="input-field">
                                    <textarea id="moderation_comments" name="moderation_comments" class="materialize-textarea"></textarea>
                                    <label for="moderation_comments">This is a required field</label>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                          <a href="javascript:{document.getElementById('denialform').submit();}" class="modal-close waves-effect waves-green btn-large red">Deny post</a>
                        </div>
                      </div>
                </div>
            </div>
            <hr>
        {% empty %}
            <p class="flow-text">No posts</p>
        {% endfor %}
    </div>
{% endblock %}